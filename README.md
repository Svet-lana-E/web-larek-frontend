# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Карточка товара с основными данными

```
interface ICard {
  id: string;
  title: string;
  category: string;
  image: string;
  price: number | null;
  description: string;
  inBasket: boolean;
} 
```
Вариант отображения карточки в корзине 

```
interface ICardCompact {
  title: string;
  price: number | null;
  index?: number;
  id?: string;
}
```
Вариант отображения карточки на главной странице

```
interface ICardCatalog {
  id: string;
  title: string;
  category: string;
  image: string;
  price: number | null;
}
```
Данные пользователя (контакты и способ оплаты заказа)

```
interface IContacts {
  payment?: string | null;
  address: string;
  phone: string;
  email: string;
}
```
Данные заказа

```
interface IOrder extends IContacts  {
  payment: string;
  total: number;
  items: string[];
}
```
Данные об успешном оформлении заказа

```
interface ISuccess {
    id: string;
    total: number;
}
```
Каталог ошибок заполнения формы заказа

```
type FormErrors = Partial<Record<keyof IContacts, string>>;
```
Данные главной страницы сайта

```
interface IPage {
    counter: number;
    catalog: HTMLElement[];
    locked: boolean;
}
```
Данные API

```
interface IAppApi {
    getItemList: () => Promise<ICard[]>;
    getItem: (id: string) => Promise<ICard>;
    placeOrder: (order: IOrder) => Promise<ISuccess>;
}
```
Общие данные форм

```
interface IFormState {
    valid: boolean;
    errors: string[];
}
```
Контент модального окна

```
interface IModalData {
    content: HTMLElement;
}
```
Ответ сервера

```
type ServerResponse<T> = {
  total: number;
  items?: T[];
}
```
Корзина товаров

```
interface IBasketView {
  items: HTMLElement[];
  total: number;
  selected: string[];
}
```

## Архитектура приложения

Архитектура приложения разрабатывается с использованием паттерна MVP:

- M - модель данных (классы, отвечающие за хранение данных и работу с ними);
- V - отображение данных (классы, отвечающие за представление данных на экране);
- P -презентер отвечает за связь и взаимодействие модели данных и отображения. В связи с небольшим количеством данных приложения код презентера не будет вынесен в отдельный класс, и будет содержаться в основном скрипте приложения, в файле 'index.ts'

### Базовый код

#### Класс Api

Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Основные методы:
- 'get' - отправляет GET запрос на переданный в параметрах endpoint и возвращает Promise с объектом, которым ответил сервер
- 'post' - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на endpoint, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен указанием третьего параметра при вызове метода.

#### Класс Component

Абстрактный класс. Является дженериком и родителем для всех классов представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод 'render' для отображения данных в компоненте. Принимает в конструктор параметром элемент разметки, являющийся основным родительским контейнером компонента.\
Содержит метод 'render', отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс EventEmitter

Выполняет роль презентера и позволяет генерировать события (в слоях приложения) и подписываться на события, происходящие в системе.
Основные методы, реализуемые классом, описаны интерфейсом 'IEvents':
- 'emit' - инициализация события,
- 'on' - подписка на события

### Модель данных

#### Класс CardsData

Класс отвечает за хранение и логику работы с данными карточек товаров.
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- '_cards: ICard[]' - массив объектов карточек товаров,
- '_preview: string | null' - id карточки товара, выбранной для показа в модальном окне
- '_events: IEvents' - экземпляр класса 'EventEmitter' для инициализации событий\
Методы класса:
- 'updateStatusInBasket' - изменение состояния нахождения товара в корзине (в корзине / не в корзине) и вызов события изменения массива
- 'getCard' - получение данных одной карточки по ее id
- прочие сеттеры, геттеры - для получения и сохранения данных полей класса

#### Класс StateData

Класс отвечает за хранение и логику работы с данными, используемыми для формирования и оформления заказа.
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- 'payment: string | null' - способ оплаты заказа,
- 'total: number | null' - общая сумма заказа
- 'items: string[]' - массив id товаров, выбранных для заказа
- 'address: string' - адрес пользователя
- 'phone: string' - телефон пользователя
- 'email: string' - email пользователя
- 'formErrors: FormErrors' - список возможных ошибок заполнения полей формы оформления заказа
- 'itemsSelected?: ICardCompact[]' - массив карточек товаров, находящихся в козине
- 'events: IEvents' - экземпляр класса 'EventEmitter' для инициализации событий\
Методы класса:

Методы класса:
-'setItemsSelected (cards: ICard[])' - отбирает помещенные в корзину карточки товаров
-'setTotalPrice()' - считает обзщую стоимость товаров, помещенных в корзину
setTotalPrice
- 'setContacts(field: keyof IContacts, value: string): void' - устанавливает значения контактных данных пользователя
- 'validateContacts' - проверяет заполнение полей формы заказа с контактными данными пользователя
- прочие сеттеры, геттеры - для получения и сохранения данных полей класса

### Классы представления

Отвечают за отображение внутри контейнера (DOM-элемент), передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Содержит общие для всех окон элементы и методы. Устанавливает слушатели на клавиатуру для закрытия модального окна по клавише Esc, на клик по кнопке-крестику и оверлею для закрытия модального окна. Конструктор принимает контейнер, в котором будут размещены данные модального окна и инстанс класса 'EventEmitter' для возможности инициализации событий.\
Элементы класса:
- '_closeButton: HTMLButtonElement' - кнопка закрытия модального окна
- '_content: HTMLElement' - внутреннее содержание модального окна\
Методы класса:
- 'set content' - устанавливает внутреннее содержание модального окна
- 'open' - устанавливает класс 'modal_active' модальному окну
- 'close' - снимает класс 'modal_active' с модального окна
- 'render' - возвращает корневой DOM-элемент

#### Класс Form<T>

Является дженериком и родителем для классов представления, содержащих формы. В дженерик принимает тип объекта, в котором данные будут передаваться в метод 'render' для отображения данных в компоненте. Устанавливает слушатели событий на кнопку 'submit' и на все поля ввода данных формы.
- 'set valid(value: boolean)' - отображает состояние активности кнопки 'submit'
- 'set errors(value: string)' - отображает текст ошибок заполнения формы
- 'render' - возвращает элемент формы

#### Класс Card<T>

Отвечает за отображение карточки. Класс расширяет класс Component<T>. В качестве дженерика класса Component<T> принимает тип данных карточки 'ICard'. В качестве дженерика класса Card<T> принимает различные типы вариантов карточки. В конструктор класса передается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки, а также инстанс класса 'EventEmitter' для возможности инициализации событий. В классе устанавливаются слушатели на все интерактивные элементы, при взаимодействии пользователя с которыми, инициализируются соответствующие события. Класс использует собственные методы и методы родительского класса Component.

#### Класс CardGallery

Отвечает за отображение карточки на главной странице сайта. Расширяет класс Card<T>. В качестве дженерика принимает интерфейс ICardCatalog. Устанавливает слушатель событий на контейнер, элемент которого является кнопкой и открывает полное отображение карточки.

#### Класс CardPreview

Отвечает за отображение превью карточки с полной информацией о товаре. Расширяет класс Card<T>. В качестве дженерика принимает интерфейс ICard. Содержит слушатель событий на кнопке удаления / добавления товара в корзину. Управляет отображением ее доступности.
- 'set description (value: string)' - устанавливает отображение описания товара


#### Класс BasketItem

Отвечает за отображение товара в корзине. Расширяет класс Component<T>. В качестве дженерика приниамет интерфейс ICardCompact(максимально урезанные данные карточки товара). Устанавливает картинку на кнопку удаления товара из корзины и порядквый номер товара в корзине. Содержит слушатель событий на кнопке удаления товара. Прочие сеттеры и геттеры.

#### Класс Basket

Отвечает за отображение корзины товаров. Класс расширяет класс Component. В качестве дженерика  принимает интерфейс 'IBasket'. В конструктор класса передается DOM-элемент темплейта, а также инстанс класса 'EventEmitter' для возможности инициализации событий. Содержит слушатель событий на кнопке 'submit'.\
Содержит сеттеры и геттеры:
- 'set items (items: HTMLElement[]): HTMLElement[]' - отображает список товаров, находящихся в корзине
- 'set selected(items: string[])' - отображает состояние активности кнопки 'submit'
- 'set total(total: number)' - устанавливает отображение общей суммы заказа

#### Класс OrderForm

Отвечает за отображение первого модального окна оформления заказа. Класс расширяет класс Form. В качестве дженерика  принимает интерфейс 'IContacts'. В конструктор класса передается DOM-элемент темплейта, а также инстанс класса 'EventEmitter' для возможности инициализации событий. В классе устанавливаются слушатели на кнопки выбора способа оплаты. Содержит геттеры для получения данных полей класса.

#### Класс ContactsForm

Отвечает за отображение второго модального окна оформления заказа с телефоном и email пользователя. Класс расширяет класс Form. В качестве дженерика  принимает интерфейс 'IContacts'. В конструктор класса передается DOM-элемент темплейта, а также инстанс класса 'EventEmitter' для возможности инициализации событий. В классе утстнавливаются слушатели на кнопки выбора способа оплаты. Содержит гетторы для получения данных полей класса.

#### Класс Success

Отвечает за отображение данных об успешном оформлении заказа. Содержит сеттер, устанавливающий отображение данных о полной стоимости оформленного заказа.

#### Класс Page
Отвечает за отображение данных на главной странице. Класс расширяет класс Component. В качестве дженерика  принимает интерфейс 'IPage'. В конструктор принимает контейнер DOM-элкмкети и инстанс брокера событий. Содержит сеттеры отображения количества товаров в корзине и блокировки прокрутки страницы. В классе устанавливается слушатель событий на кнопку открытия корзины.

### Слой коммуникации

#### Класс AppApi

Отвечает за взаимодействие с бэкендом сервиса. Расширяет класс 'Api' и его методы, например, такие, как 'get' и 'post' и пр. В конструктор принимает основной базовый URL, URL адреса доставки контента (CDN) и, опционально, объект с настройками заголовков.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой, находится в файле 'index.ts', выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в 'index.ts'.\
В 'index.ts' сначала создаются экземпляры всех необходимых классов, а затем настраиваются обработчики.

*Список всех событий, которые могут генерироваться в системе*\
*События изменения данных (генерируются классами моделями данных)*\
- `cards:changed` - изменился каталог карточек
- `card:selected` - выбрана карточка товара из каталога
- `card:addedToBasket` - изменился статус карточки товара в корзине
- `order.address:changed` - изменились данные адреса пользователя
- `order.payment:changed` - изменились данные способа платежа
- `contacts.phone:changed` - изменились данные телефона пользователя
- `contacts.email:changed` - изменились данные email пользователя
- `formErrors:order.change` - изменился список ошибок в форме 'Order'
- `formErrors:change` - изменился список ошибок в форме 'Contacts'
- `order:ready` - успешная валидация всех полей всех форм заказа


*События, возникающие при взаимодействии пользователя с интерфейсом(генерируются классами представления)*\
*- `initialData:loaded` - загрузились первоначальные данные с сервера (первоначальная загрузка страницы)
*- `modal:open` - модальное окно открыто
*- `modal:close` - модальное окно закрыто
*- `order:open` - нажата кнопка оформления заказа в корзине
*- `oder:close` - нажата кнопка закрытия окна подтверждения заказа
*- `order:submit` - нажата кнопка 'submit' в форме 'order'
*- `order:change` - произошли изменения в форме 'order'
*- `contacts:submit` - нажата кнопка 'submit' в форме 'contacts'
*- `contacts:change` - произошли изменения в форме 'contacts'
*- `card:basket` - кнопка "Корзина" в карточке товара
*- `cardPreview:open` - выбор карточки для отображения в модальном окне
*- `basket:open` - нажата кнопка корзины на главной странице
*- `basketItem:delete` - нажата кнопка удаления товара из корзины










